/*\n  # Add WhatsApp Verification Tokens Table\n\n  1. New Tables\n    - `whatsapp_verification_tokens`\n      - `id` (uuid, primary key) - Unique identifier\n      - `auth_user_id` (uuid) - References auth.users for the authenticated user\n      - `crm_user_id` (text) - The CRM user ID from the verification link\n      - `otp_code` (text) - The OTP code from the verification link\n      - `email` (text) - User's email address\n      - `name` (text) - User's full name\n      - `verified_at` (timestamptz) - When the verification was completed\n      - `created_at` (timestamptz) - When the token was created\n\n  2. Security\n    - Enable RLS on `whatsapp_verification_tokens` table\n    - Add policy for authenticated users to read their own tokens\n    - Add policy for authenticated users to update their own tokens\n\n  3. Notes\n    - This table stores verification tokens that link auth users to CRM users\n    - Tokens are created when users authenticate before WhatsApp verification\n    - After successful verification, the `verified_at` timestamp is updated\n*/\n\nCREATE TABLE IF NOT EXISTS whatsapp_verification_tokens (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  auth_user_id uuid REFERENCES auth.users(id) ON DELETE CASCADE,\n  crm_user_id text NOT NULL,\n  otp_code text NOT NULL,\n  email text NOT NULL,\n  name text NOT NULL,\n  verified_at timestamptz,\n  created_at timestamptz DEFAULT now(),\n  UNIQUE(auth_user_id, crm_user_id)\n);
\n\nALTER TABLE whatsapp_verification_tokens ENABLE ROW LEVEL SECURITY;
\n\nCREATE POLICY "Users can read own verification tokens"\n  ON whatsapp_verification_tokens\n  FOR SELECT\n  TO authenticated\n  USING (auth.uid() = auth_user_id);
\n\nCREATE POLICY "Users can insert own verification tokens"\n  ON whatsapp_verification_tokens\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (auth.uid() = auth_user_id);
\n\nCREATE POLICY "Users can update own verification tokens"\n  ON whatsapp_verification_tokens\n  FOR UPDATE\n  TO authenticated\n  USING (auth.uid() = auth_user_id)\n  WITH CHECK (auth.uid() = auth_user_id);
\n;
